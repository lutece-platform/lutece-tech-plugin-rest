<#include "utils.ftl" >

<#function isOdjReference odj  listOdjReference >
	<#local bOdjReference=false>
		<#list  listOdjReference as odjReference >
	  		<#if odjReference.idOrdreDuJour==odj.idOrdreDuJour>
					 <#local bOdjReference=true>
			</#if>
	  	</#list>	
	<#return bOdjReference>
</#function>
<a name="TOP" id="TOP"></a>
<div id="page-content-left">
	<#include "page_content_left.html">
</div>
<div id="page-content-right">
	<#if seance?exists>
		<div id="out-min-height">
			<div id="in-min-height">
				<div id="one-zone-first">
					<div id="one-zone-first-content">
						<h1>#i18n{ods.front.prochainconseil.label.title}</h1>
						<h2>
							<#if seance.dateSeance?string("ddMMyyyy") = seance.dateCloture?string("ddMMyyyy") >
								#i18n{ods.front.prochainconseil.label.seance.le}
								${seance.dateSeance?string(" EEEE dd MMMM yyyy")}
							<#else>
								#i18n{ods.front.prochainconseil.label.seance.du}
								<#if seance.dateSeance?string("MMMM") != seance.dateCloture?string("MMMM")>
									${seance.dateSeance?string("EEEE dd MMMM ")}
								<#else>
									${seance.dateSeance?string("EEEE dd ")}
								</#if>
								#i18n{ods.front.prochainconseil.label.seance.au}
								${seance.dateCloture?string(" EEEE dd MMMM yyyy")}
							</#if>
						</h2>
					
						<!--bloc-->
						<#if seance.tailleArchive?exists && (seance.tailleArchive > -1) >
						<p>
							<a href="${url_download_documents_seance}" target="_blank">#i18n{ods.front.prochainconseil.label.telechargerdocuments}</a>
							<#if (seance.tailleArchive >= 1000000)>
								<span class="ods-notes">(Zip - ${(seance.tailleArchive / 1000000)?string(",##0.00")} #i18n{ods.listefichiers.label.mo})</span>
							<#elseif (seance.tailleArchive >= 1000)>
								<span class="ods-notes">(Zip - ${(seance.tailleArchive / 1000)?string(",##0.00")} #i18n{ods.listefichiers.label.ko})</span>
							<#else>
								<span class="ods-notes">(Zip - ${seance.tailleArchive?string(",##0.00")} #i18n{ods.listefichiers.label.o})</span>
							</#if>
							
							<span class="ods-notes">(#i18n{ods.front.pdd.label.publierle} ${seance.datePublicationArchive?string("dd/MM/yyyy")})</span>
						</p>
						<#else>
							#i18n{ods.front.prochainconseil.label.noTelechargerDocuments}
						</#if>
						
						<ul  class="list">
							<li>
								#i18n{ods.front.prochainconseil.label.projet}
								<#list liste_formation_conseil_pj as formationConseil>
									<a href="jsp/site/Portal.jsp?page=ods_direction_list&id_seance=${seance.idSeance}&id_formation_conseil=${formationConseil.idFormationConseil}">${formationConseil.libelle}</a>
									<#if formationConseil_has_next>,</#if>
								</#list>
							</li>
							<li>
								#i18n{ods.front.prochainconseil.label.proposition}
								<#list liste_formation_conseil_pp as formationConseil>
									<a href="jsp/site/Portal.jsp?page=ods_pdd_list&id_seance=${seance.idSeance}&id_formation_conseil=${formationConseil.idFormationConseil}&type=PP">${formationConseil.libelle}</a>
									<#if formationConseil_has_next>,</#if>
								</#list>
							</li>
							<li>
								#i18n{ods.front.prochainconseil.label.amendement}
								<#list liste_formation_conseil_va as formationConseil>
									<a href="jsp/site/Portal.jsp?page=ods_liasse&id_seance=${seance.idSeance}&id_formation_conseil=${formationConseil.idFormationConseil}">${formationConseil.libelle}</a>
									<#if formationConseil_has_next>,</#if>
								</#list>
							</li>
						</ul>
						
						<ul class="ods-anchors">
								<#if (liste_document_seance?size > 0)>
									<li>
										<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil#ANC_1">
											#i18n{ods.front.prochainconseil.label.odj}
										</a>
										#i18n{ods.front.prochainconseil.label.odj.def}
									</li>
								</#if>
								
								<#if (liste_autres_documents_seance?size > 0)>
									<li>
									<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil#ANC_2">
										#i18n{ods.front.prochainconseil.label.autreDocumentSeance}
									</a>
									#i18n{ods.front.prochainconseil.label.autreDocumentSeance.def}
									</li>
								</#if>
								
								<li>
								<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil&id_commission=${id_commission}#ANC_3">
									#i18n{ods.front.prochainconseil.label.documentscommissions}
								</a>
								#i18n{ods.front.prochainconseil.label.documentscommissions.def}
							</li> 
						</ul>
						
						<#if (liste_document_seance?size > 0)>
							<a name="ANC_1" id="ANC_1"></a>
							<h3>#i18n{ods.front.prochainconseil.label.odj}</h3>
							<table class="data-table">
								<tr>
									<td nowrap="nowrap">#i18n{ods.front.prochainconseil.label.datepublication}</td>
									<td>#i18n{ods.front.prochainconseil.label.document}</td>
								</tr>
								<#list liste_document_seance as docOdj>
									<#if docOdj.ordreDuJour?exists>
										<#if isOdjReference(docOdj.ordreDuJour,liste_ordre_du_jour_reference)>
											<tr class="even-row">
												<td nowrap="nowrap">${docOdj.ordreDuJour.datePublication?string(" EEEE dd MMMM yyyy")}</td>
												<td>
													<a href="jsp/site/Portal.jsp?page=ods_odj&id_odj=${docOdj.ordreDuJour.idOrdreDuJour}">
														${docOdj.ordreDuJour.intitule}
													</a>
										        	<#if liste_odj_nouveaux?exists && estOdjDansListe(docOdj.ordreDuJour,liste_odj_nouveaux)>
														<#if docOdj.ordreDuJour.version?exists && ( docOdj.ordreDuJour.version > 1 )>
										 					<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
										 				<#else>
															<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
										 				</#if>
													</#if>
												</td> 
											</tr>
										</#if>
									<#elseif  docOdj.fichier?exists>
										<tr class="even-row">
											<td nowrap="nowrap">${docOdj.fichier.datePublication?string(" EEEE dd MMMM yyyy")} </td>
											<td>
												<img src="images/local/skin/plugins/ods/icon-pdf.gif" alt="Pdf">
												<a href="jsp/site/plugins/ods/DoDownload.jsp?id_fichier=${docOdj.fichier.id}" target="_blank">
													${docOdj.fichier.titre}
												</a>
												<#if liste_fichiers_nouveaux?exists && estFichierDansListe(docOdj.fichier,liste_fichiers_nouveaux)>
													<#if docOdj.fichier.version?exists && ( docOdj.fichier.version > 1 )>
										 				<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
										 			<#else>
														<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
										 			</#if>
												</#if>
												<span class="ods-notes">
													(${docOdj.fichier.extension} - ${docOdj.fichier.tailleKo}#i18n{ods.front.liasse.label.ko})
												</span>
											</td>
										</tr>
									</#if>
								</#list>
							</table>
							<div class="ods-top">
								<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil&id_commission=${id_commission}#TOP">
									#i18n{ods.front.prochainconseil.label.hautPage}
								</a>
							</div>
						</#if>
						
						<!--bloc-->
						<#if (liste_autres_documents_seance?size > 0) >
							<a name="ANC_2" id="ANC_2"></a>
							<h3>#i18n{ods.front.prochainconseil.label.autreDocumentSeance}</h3>
							<table class="data-table">
								<tr>
									<td nowrap="nowrap">#i18n{ods.front.prochainconseil.label.datepublication}</td>
									<td>#i18n{ods.front.prochainconseil.label.document}</td>
								</tr>
								<#list liste_autres_documents_seance as docOdj>
									<#if docOdj.fichier?exists>
										<tr class="even-row">
											<td nowrap="nowrap">${docOdj.fichier.datePublication?string(" EEEE dd MMMM yyyy")} </td>
											<td>
												<img src="images/local/skin/plugins/ods/icon-pdf.gif" alt="Pdf">
												<a href="jsp/site/plugins/ods/DoDownload.jsp?id_fichier=${docOdj.fichier.id}" target="_blank">
													${docOdj.fichier.titre}
												</a>
												<#if liste_fichiers_nouveaux?exists && estFichierDansListe(docOdj.fichier,liste_fichiers_nouveaux)>
													<#if docOdj.fichier.version?exists && ( docOdj.fichier.version > 1 )>
										 				<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
										 			<#else>
														<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
										 			</#if>
												</#if>
												<span class="ods-notes">
													(${docOdj.fichier.extension} - ${docOdj.fichier.tailleKo}#i18n{ods.front.liasse.label.ko})
												</span>
											</td>
										</tr>
									</#if>
								</#list>
							</table>
							<div class="ods-top">
								<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil&id_commission=${id_commission}#TOP">
									#i18n{ods.front.prochainconseil.label.hautPage}
								</a>
							</div>
						</#if>
						
						<!--bloc-->
						<a name="ANC_3" id="ANC_3"></a>
						<h3>#i18n{ods.front.prochainconseil.label.documentscommissions}</h3>
						<p>#i18n{ods.front.prochainconseil.label.pourafficherdocument}</p>
						<form action="jsp/site/Portal.jsp?page=ods_prochain_conseil#ANC_3" method="post">
							<#if (!liste_commission?exists) || (liste_commission?size < 1)>
								<strong>#i18n{ods.front.prochainconseil.message.noCommission}</strong>
							<#else>
								<label for="">#i18n{ods.front.prochainconseil.label.numerocommission} </label>
								<@combo name="id_commission"  items=liste_commission  default_value=id_commission />
								<input name="" type="submit" value="Afficher" id="ods-btn-affiche" />
							</#if>
						</form>
						<p class="espace_10"></p>
						<#if (liste_ordre_du_jour_commission?size > 0) >
							<table class="data-table">
								<tr>
									<td nowrap="nowrap">#i18n{ods.front.prochainconseil.label.datepublication}</td>
									<td>#i18n{ods.front.prochainconseil.label.document}</td>
								</tr>
								<#list liste_ordre_du_jour_commission as docOdj>
									<#if docOdj.ordreDuJour?exists>
										<tr class="even-row">
											<td nowrap="nowrap">${docOdj.ordreDuJour.datePublication?string(" EEEE dd MMMM yyyy")}</td>
											<td>
												<a href="jsp/site/Portal.jsp?page=ods_odj&id_odj=${docOdj.ordreDuJour.idOrdreDuJour}">
													${docOdj.ordreDuJour.intitule}
												</a>
									        	<#if liste_odj_nouveaux?exists && estOdjDansListe(docOdj.ordreDuJour,liste_odj_nouveaux)>
													<#if docOdj.ordreDuJour.version?exists && ( docOdj.ordreDuJour.version > 1 )>
									 					<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
									 				<#else>
														<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
									 				</#if>
												</#if>
											</td>
										</tr>
									<#elseif  docOdj.fichier?exists>
										<tr class="even-row">
											<td nowrap="nowrap">${docOdj.fichier.datePublication?string(" EEEE dd MMMM yyyy")} </td>
											<td>
												<img src="images/local/skin/plugins/ods/icon-pdf.gif" alt="Pdf">	
												<a href="jsp/site/plugins/ods/DoDownload.jsp?id_fichier=${docOdj.fichier.id}" target="_blank">
													${docOdj.fichier.titre}
												</a>
												<#if liste_fichiers_nouveaux?exists && estFichierDansListe(docOdj.fichier,liste_fichiers_nouveaux)>
													<#if docOdj.fichier.version?exists && ( docOdj.fichier.version > 1 )>
										 				<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
										 			<#else>
														<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
										 			</#if>
												</#if>
												<span class="ods-notes">
													(${docOdj.fichier.extension} - ${docOdj.fichier.tailleKo}#i18n{ods.front.liasse.label.ko})
												</span>
											</td>
										</tr>
									</#if>
								</#list>
							</table>
						</#if>
						
						<ul class="list">
							<#if releve?exists>
								<li>
									<a href="jsp/site/Portal.jsp?page=ods_releve_travaux_comm&id_releve=${releve.idReleveDesTravaux}">
										${releve.intitule}
									</a>
								</li>
							</#if>
						</ul>
						
						<#if (liste_ordre_du_jour_commission?size > 0) || (releve?exists) >
						<div class="ods-top">
							<a href="jsp/site/Portal.jsp?page=ods_prochain_conseil&id_commission=${id_commission}#TOP">
								#i18n{ods.front.prochainconseil.label.hautPage}
							</a>
						</div>
						</#if>

						<div class="ods-legend"><strong>#i18n{ods.front.prochainconseil.label.legende}</strong>
							<ul>
								<li>
									<span class="ods-flag-N" title="#i18n{ods.front.deliberations.title.nouveau}">#i18n{ods.front.deliberations.label.nouveau}</span>
									= #i18n{ods.front.deliberations.nouveaudocument}
								</li>
								<li>
									<span class="ods-flag-M" title="#i18n{ods.front.deliberations.title.modifie}">#i18n{ods.front.deliberations.label.modifie}</span>
									= #i18n{ods.front.deliberations.nouvelleversion}
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
	<#else>
		<h1>Probleme de parametres</h1>
	</#if>
</div>
